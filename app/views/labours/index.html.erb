<%- model_class = Labour -%>
<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <h2>Labours</h2>
      <hr>
      <div class="table-responsive">

<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th><%= model_class.human_attribute_name(:id) %></th>
      <th><%= model_class.human_attribute_name(:first_name) %></th>
      <th><%= model_class.human_attribute_name(:last_name) %></th>
      <th><%= model_class.human_attribute_name(:phone_no) %></th>
      <th><%= model_class.human_attribute_name(:date_of_joining) %></th>
      <th><%= model_class.human_attribute_name(:salary_per_day) %></th>
      <th><%= model_class.human_attribute_name(:salary_for_hours) %></th>
      <th><%=t '.actions', :default => t("helpers.actions") %></th>
    </tr>
  </thead>
  <tbody>
    <% @labours.each do |labour| %>
      <tr <%= labour.on_vacation == true ? "class=danger" : "" %>>
        <td><%= link_to labour.id, labour_path(labour) %></td>
        <td><%= labour.first_name %></td>
        <td><%= labour.last_name %></td>
        <td><%= labour.phone_no %></td>
        <td><%= labour.date_of_joining %></td>
        <td><%= labour.salary_per_day %></td>
        <td><%= labour.salary_for_hours %></td>
        <td>
          <%= link_to "Modify",
                      edit_labour_path(labour), :class => 'btn btn-default btn-xs' %>
          <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                      labour_path(labour),
                      :method => :delete,
                      :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                      :class => 'btn btn-xs btn-danger' %>


        </td>
      </tr>
    <% end %>
  </tbody>
</table>
      </div>

      <%= simple_form_for 'presence', url: labours_path do |f| %>
  <% @labours.each_with_index do |labour,i| %>
  <tr>
  <td><%= i + 1 %> . </td>
 hi
    <%= hidden_field_tag "presence[labour][#{i}][date]" , @date %>
  <%= hidden_field_tag "presence[labour][#{i}][labour_id]", labour.id %>
  <td><%= text_field_tag "", "#{labour.first_name} #{labour.last_name}" %></td>
  <% work_array = Work.joins(:client).where("clients.on_vacation is not true").map { |work| ["#{work.client.first_name} #{work.client.last_name}",work.id] } %>
  <% work_id =  labour.work.nil? ? work_array.first[1] : labour.work.id %>
  <% unless labour.attendances.where(date: @date).last.nil? %>
  <% unless labour.attendances.where(date: @date).last.nil? %>
  <% work_id = labour.attendances.where(date: @date).last.work_id %>
  <% end %>
  <% end %>
  <td><%= select_tag "presence[labour][#{i}][work_id]", options_for_select(work_array, "#{work_id}")  %></td>
  <%  m = labour.attendances.where(date: @date).last %>
  <% m.nil? ? 0 : h = m.hours  %>
  <td><%= select_tag "presence[labour][#{i}][hours]", options_for_select({"A" => 0,"'" => 2,"''" => 4,"'''" => 6,"P" => 8,"P'" => 10,"P''" => 12,"P'''" => 14,"PP" => 16,"PP'" => 18,"PP''" => 20,"PP'''" => 22,"PPP" => 24}, h ), include_blank: true, class: "hours" %></td>
  <td><%= text_field_tag "presence[labour][#{i}][in]" %></td>
  <td><%= text_field_tag "presence[labour][#{i}][out]" %></td>
  </tr>

<hr>
<%= link_to t('.new', :default => t("helpers.links.new")),
            new_labour_path,
            :class => 'btn btn-primary' %>

    </div>
  </div>
</div>
