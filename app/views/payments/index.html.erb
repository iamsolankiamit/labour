<div class="container">
  <div class="row">
  <div>Date: <input type="text" id="datepicker"> </div>
    <div class="col-sm-6">
      <div class="table-responsive">
        <table class="table table-bordered table-striped">
          <thead>
            <td>Labour</td>
            <td>Amount</td>
            <td>Comment</td>
          </thead>
          <tbody>

<%= form_for 'payment', url: payments_path do %>
  <% @labours.each_with_index do |labour,i| %>
            <tr>

    <%= hidden_field_tag "payment[#{i}][date]" , Date.today %>
  <%= hidden_field_tag "payment[#{i}][labour_id]", labour.id %>
              <td><%= link_to "#{labour.first_name} #{labour.last_name}", payment_url(labour.id) %></td>
              <td><%= text_field_tag "payment[#{i}][amount_paid]" %></td>
              <td><%= text_field_tag "payment[#{i}][comment]" %></td>
            </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <button class="btn btn-primary btn-large">Okay</button>
            <% end %>

    </div>
    <div class="col-sm-6">
      <h2><%= @labours.first.first_name %> <%= @labours.first.last_name %></h2>
      Advanced Details: <%= @labours.first.account_setteled_on ? @labours.first.account_setteled_on : @labours.first.created_at.to_date %> to <%= Date.today %>.

      <div style="border: 1px solid grey;"> Account Details
  <table class="table table-borderd table-striped">
    <thead>
      <td>Sr no</td>
      <td>Date</td>
      <td>Amount</td>
      <td>Comment</td>
    </thead>
    <tbody>
      <% Payment.where("labour_id = ? and date between ? and ?", @labours.first.id,@labours.first.created_at, Date.today).each_with_index do |p,i| %>
        <tr>
          <td><%= i %></td>
          <td><%= p.date %></td>
          <td><%= p.amount_paid %></td>
          <td><%= p.comment %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
      </div>
      <table class="table table-bordered table-striped">
        <tbody>
          <tr>
            <td>Attendance Total</td>
            <td>
                    <% hours = 0 %>
      <% salary = 0 %>
      <% advance = 0 %>
      <% Attendance.where("labour_id = ? and date >= ? and date <= ?", @labours.first.id,@labours.first.created_at, Date.today).each do |a|
              hours += a.hours unless a.hours.nil?
              salary += a.salary unless a.salary.nil?
            end
              %>
            <%= hours/@labours.first.salary_for_hours  %>
            </td>
          </tr>
          <tr>
            <td>Total Advance</td>
            <td>
                    <% Payment.where("labour_id = ? and date >= ? and date <= ?", @labours.first.id,@labours.first.created_at, Date.today).each do |p|
        advance += p.amount_paid unless p.amount_paid.nil?
      end %>
      <%= advance %>

            </td>
          </tr>
          <tr>
            <td>Net Payable</td>
            <td>
              <%= salary - advance %>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>